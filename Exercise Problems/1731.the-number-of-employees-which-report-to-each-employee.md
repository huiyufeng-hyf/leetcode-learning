https://leetcode.cn/problems/the-number-of-employees-which-report-to-each-employee/description/ 

- Solution by group and having operation with round the result
```
/* Write your T-SQL query statement below */
SELECT e2.employee_id, e2.name, COUNT(*) AS 'reports_count', ROUND(SUM(e1.age) * 1.0 / COUNT(*), 0) AS 'average_age'
FROM Employees e1
INNER JOIN Employees e2 on e1.reports_to = e2.employee_id
GROUP BY e2.employee_id, e2.name
HAVING COUNT(*) > 0
ORDER BY e2.employee_id

```

---

- Recommendation by statistic and merge in Pandas
```
import pandas as pd

def count_employees(employees: pd.DataFrame) -> pd.DataFrame:
    df = employees.groupby('reports_to').agg(
        reports_count=('employee_id', 'count'), 
        average_age=('age', 'mean')
    ).reset_index().rename(columns={'reports_to': 'employee_id'})

    df['average_age'] = df['average_age'].apply(lambda x: int(x + 0.5))

    df = df.merge(employees[['employee_id', 'name']], on='employee_id', how='left')

    return df[['employee_id', 'name', 'reports_count', 'average_age']]
    
```

---

- Recommendation by copilot
```
import pandas as pd

def count_employees(employees: pd.DataFrame) -> pd.DataFrame:
    # Group only rows where an employee reports to someone
    grouped = (
        employees[employees['reports_to'].notna()]
        .groupby('reports_to', as_index=False)
        .agg(
            reports_count=('employee_id', 'count'),
            average_age=('age', 'mean')
        )
    )

    # Rename reports_to to employee_id (manager id)
    grouped = grouped.rename(columns={'reports_to': 'employee_id'})

    # Round average_age (half-up)
    grouped['average_age'] = (grouped['average_age'] + 0.5).astype(int)

    # Attach manager name
    grouped = grouped.merge(
        employees[['employee_id', 'name']],
        on='employee_id',
        how='left'
    )

    # Return ordered columns
    return grouped[['employee_id', 'name', 'reports_count', 'average_age']].sort_values('employee_id')
```
